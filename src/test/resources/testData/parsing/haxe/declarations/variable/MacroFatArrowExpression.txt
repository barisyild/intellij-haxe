Haxe File
  PACKAGE_STATEMENT
    HaxePsiToken:package('package')
    HaxePsiToken:;(';')
  IMPORT_STATEMENT
    HaxePsiToken:import('import')
    REFERENCE_EXPRESSION
      REFERENCE_EXPRESSION
        REFERENCE_EXPRESSION
          IDENTIFIER
            HaxePsiToken:ID('haxe')
        HaxePsiToken:.('.')
        IDENTIFIER
          HaxePsiToken:ID('macro')
      HaxePsiToken:.('.')
      IDENTIFIER
        HaxePsiToken:ID('Expr')
    HaxePsiToken:;(';')
  MODULE
    CLASS_DECLARATION
      HaxePsiToken:class('class')
      COMPONENT_NAME
        IDENTIFIER
          HaxePsiToken:ID('MapBuilder')
      CLASS_BODY
        HaxePsiToken:{('{')
        METHOD_DECLARATION
          METHOD_MODIFIER
            HaxePsiToken:public('public')
          METHOD_MODIFIER
            HaxePsiToken:macro('macro')
          HaxePsiToken:function('function')
          COMPONENT_NAME
            IDENTIFIER
              HaxePsiToken:ID('build')
          HaxePsiToken:(('(')
          PARAMETER_LIST
            PARAMETER
              COMPONENT_NAME
                IDENTIFIER
                  HaxePsiToken:ID('names')
              TYPE_TAG
                HaxePsiToken::(':')
                TYPE_OR_ANONYMOUS
                  TYPE
                    REFERENCE_EXPRESSION
                      IDENTIFIER
                        HaxePsiToken:ID('Array')
                    TYPE_PARAM
                      HaxePsiToken:<('<')
                      TYPE_LIST
                        TYPE_LIST_PART
                          TYPE_OR_ANONYMOUS
                            TYPE
                              REFERENCE_EXPRESSION
                                IDENTIFIER
                                  HaxePsiToken:ID('String')
                      HaxePsiToken:>('>')
          HaxePsiToken:)(')')
          TYPE_TAG
            HaxePsiToken::(':')
            TYPE_OR_ANONYMOUS
              TYPE
                REFERENCE_EXPRESSION
                  IDENTIFIER
                    HaxePsiToken:ID('Array')
                TYPE_PARAM
                  HaxePsiToken:<('<')
                  TYPE_LIST
                    TYPE_LIST_PART
                      TYPE_OR_ANONYMOUS
                        TYPE
                          REFERENCE_EXPRESSION
                            IDENTIFIER
                              HaxePsiToken:ID('Field')
                  HaxePsiToken:>('>')
          BLOCK_STATEMENT
            HaxePsiToken:{('{')
            LOCAL_VAR_DECLARATION_LIST
              MUTABILITY_MODIFIER
                HaxePsiToken:var('var')
              LOCAL_VAR_DECLARATION
                COMPONENT_NAME
                  IDENTIFIER
                    HaxePsiToken:ID('map')
                TYPE_TAG
                  HaxePsiToken::(':')
                  TYPE_OR_ANONYMOUS
                    TYPE
                      REFERENCE_EXPRESSION
                        IDENTIFIER
                          HaxePsiToken:ID('Array')
                      TYPE_PARAM
                        HaxePsiToken:<('<')
                        TYPE_LIST
                          TYPE_LIST_PART
                            TYPE_OR_ANONYMOUS
                              TYPE
                                REFERENCE_EXPRESSION
                                  IDENTIFIER
                                    HaxePsiToken:ID('Expr')
                        HaxePsiToken:>('>')
                VAR_INIT
                  HaxePsiToken:=('=')
                  ARRAY_LITERAL
                    HaxePsiToken:[('[')
                    HaxePsiToken:](']')
              HaxePsiToken:;(';')
            FOR_STATEMENT
              HaxePsiToken:for('for')
              HaxePsiToken:(('(')
              VALUE_ITERATOR
                COMPONENT_NAME
                  IDENTIFIER
                    HaxePsiToken:ID('name')
              HaxePsiToken:in('in')
              ITERABLE
                REFERENCE_EXPRESSION
                  IDENTIFIER
                    HaxePsiToken:ID('names')
              HaxePsiToken:)(')')
              BLOCK_STATEMENT
                HaxePsiToken:{('{')
                PsiComment(MSL_COMMENT)('// fat arrow allowed when used in macro expression')
                CALL_EXPRESSION
                  REFERENCE_EXPRESSION
                    REFERENCE_EXPRESSION
                      IDENTIFIER
                        HaxePsiToken:ID('map')
                    HaxePsiToken:.('.')
                    IDENTIFIER
                      HaxePsiToken:ID('push')
                  HaxePsiToken:(('(')
                  CALL_EXPRESSION_LIST
                    MACRO_VALUE_EXPRESSION
                      HaxePsiToken:macro('macro')
                      MAP_INITIALIZER_EXPRESSION_LIST
                        MAP_INITIALIZER_EXPRESSION
                          VALUE_EXPRESSION
                            MACRO_EXPRESSION_REIFICATION
                              MACRO_VALUE_REIFICATION
                                HaxePsiToken:MACRO_ID('$v')
                                HaxePsiToken:{('{')
                                REFERENCE_EXPRESSION
                                  IDENTIFIER
                                    HaxePsiToken:ID('name')
                                HaxePsiToken:}('}')
                          HaxePsiToken:=>('=>')
                          VALUE_EXPRESSION
                            MACRO_EXPRESSION_REIFICATION
                              MACRO_VALUE_REIFICATION
                                HaxePsiToken:MACRO_ID('$v')
                                HaxePsiToken:{('{')
                                REFERENCE_EXPRESSION
                                  REFERENCE_EXPRESSION
                                    IDENTIFIER
                                      HaxePsiToken:ID('name')
                                  HaxePsiToken:.('.')
                                  IDENTIFIER
                                    HaxePsiToken:ID('length')
                                HaxePsiToken:}('}')
                  HaxePsiToken:)(')')
                HaxePsiToken:;(';')
                HaxePsiToken:}('}')
            RETURN_STATEMENT
              HaxePsiToken:return('return')
              REFERENCE_EXPRESSION
                IDENTIFIER
                  HaxePsiToken:ID('fields')
              HaxePsiToken:;(';')
            HaxePsiToken:}('}')
        HaxePsiToken:}('}')